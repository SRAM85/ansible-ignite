---
# tasks file for ignite
- name: add ignite group
  group: name=ignite state=present

- name: add ignite user
  user: >
    name=ignite
    group=ignite
    home={{ignite_home}}

- name: download ignite
  get_url: >-
    url={{ignite_url}}
    dest={{ignite_home}}/{{ignite_zip}}
    owner=ignite
    group=ignite
    mode=644

- name: unarchive
  unarchive: >-
    copy=no
    src={{ignite_home}}/{{ignite_zip}}
    dest={{ignite_home}}
    owner=ignite
    group=ignite
    creates={{ignite_home}}/{{ignite_name}}

- name: install config
  template: >-
    src=config/default-config.xml.j2
    dest={{ignite_home}}/{{ignite_name}}/config/default-config.xml
    owner=ignite
    group=ignite
    mode=0644
    
- name: install ignite.service
  template: >-
    src=usr/lib/systemd/system/ignite.service.j2
    dest=/usr/lib/systemd/system/ignite.service
    owner=root
    group=root
    mode=0644
  register: ignite_service_installed

- name: systemctl daemon-reload
  command: systemctl daemon-reload
  when: ignite_service_installed|changed
  
- name: start ignite
  service: name=ignite enabled=yes state=started
